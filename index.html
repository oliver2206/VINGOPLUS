<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Card Generator</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .bingo-cell {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .bingo-cell:hover {
            transform: scale(1.05);
        }
        
        .bingo-cell.called {
            background-color: #3B82F6;
            color: white;
        }
        
        .bingo-cell.marked {
            background-color: white !important;
            color: black !important;
            border: 2px solid #3B82F6;
        }
        
        .bingo-cell.editing {
            border: 2px dashed #EF4444;
            background-color: #FEF3C7;
        }
        
        /* Number color coding */
        .number-b {
            background-color: #3B82F6 !important;
            color: white !important;
        }
        
        .number-i {
            background-color: #EF4444 !important;
            color: white !important;
        }
        
        .number-n {
            background-color: #6B7280 !important;
            color: white !important;
        }
        
        .number-g {
            background-color: #10B981 !important;
            color: white !important;
        }
        
        .number-o {
            background-color: #F59E0B !important;
            color: white !important;
        }
        
        /* Lucky number badges color coding */
        .lucky-badge-b {
            background-color: #3B82F6 !important;
            color: white !important;
        }
        
        .lucky-badge-i {
            background-color: #EF4444 !important;
            color: white !important;
        }
        
        .lucky-badge-n {
            background-color: #6B7280 !important;
            color: white !important;
        }
        
        .lucky-badge-g {
            background-color: #10B981 !important;
            color: white !important;
        }
        
        .lucky-badge-o {
            background-color: #F59E0B !important;
            color: white !important;
        }
        
        .card-container {
            perspective: 1000px;
        }
        
        .bingo-card {
            transition: transform 0.5s;
        }
        
        .bingo-card:hover {
            transform: rotateY(5deg);
        }
        
        .drag-area {
            transition: all 0.3s ease;
        }
        
        .drag-area.active {
            border-color: #3B82F6;
            background-color: #EFF6FF;
        }
        
        .uploaded-image {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            object-fit: contain;
        }
        
        .analysis-animation {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% {
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                opacity: 0.6;
            }
        }
        
        .number-badge {
            transition: all 0.3s ease;
        }
        
        .number-badge:hover {
            transform: scale(1.1);
        }
        
        .pattern-x {
            background-color: #EF4444 !important;
            color: white !important;
        }
        
        .pattern-four-corners {
            background-color: #10B981 !important;
            color: white !important;
        }
        
        .pattern-blackout {
            background-color: #ff0000 !important;
            color: white !important;
        }
        
        .pattern-line {
            background-color: #F59E0B !important;
            color: white !important;
        }
        
        .pattern-hallow {
            background-color: #8B5CF6 !important;
            color: white !important;
        }
        
        .pattern-selection {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pattern-selection:hover {
            transform: scale(1.05);
        }
        
        .pattern-selection.selected {
            border-color: #3B82F6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
        }
        
        .pattern-preview {
            width: 100px;
            height: 100px;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 2px;
            margin: 0 auto;
        }
        
        .pattern-cell {
            background-color: #E5E7EB;
            border-radius: 4px;
        }
        
        .pattern-cell.active {
            background-color: #3B82F6;
        }
        
        .lucky-chart-tab {
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            padding: 0.5rem 0.25rem;
        }
        
        .lucky-chart-tab.active {
            background-color: #3B82F6;
            color: white;
        }
        
        .lucky-chart {
            display: none;
        }
        
        .lucky-chart.active {
            display: block;
        }
        
        @media print {
            .no-print {
                display: none !important;
            }
            .bingo-card {
                break-inside: avoid;
                margin-bottom: 20px;
            }
        }
        
        /* New styles for hiding/showing cards */
        .cards-section {
            display: none;
        }
        
        .cards-section.visible {
            display: block;
        }
        
        .cards-placeholder {
            text-align: center;
            padding: 3rem;
            background-color: #f8fafc;
            border-radius: 0.75rem;
            border: 2px dashed #cbd5e0;
        }
        
        .cards-placeholder i {
            font-size: 3rem;
            color: #9ca3af;
            margin-bottom: 1rem;
        }
        
        .sample-screenshot {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
        }
        
        /* New styles for probability indicators */
        .probability-indicator {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            margin-top: 0.5rem;
        }
        
        .high-probability {
            background-color: #10B981;
            color: white;
        }
        
        .medium-probability {
            background-color: #F59E0B;
            color: white;
        }
        
        .low-probability {
            background-color: #EF4444;
            color: white;
        }
        
        .winning-pattern {
            background-color: #8B5CF6;
            color: white;
            padding: 0.5rem;
            border-radius: 0.5rem;
            margin-top: 0.5rem;
            font-weight: bold;
            text-align: center;
        }
        
        .edit-mode {
            border: 2px solid #EF4444;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
        }
        
        .edit-input {
            width: 100%;
            text-align: center;
            border: none;
            background: transparent;
            font-weight: bold;
            font-size: 1rem;
        }
        
        .edit-input:focus {
            outline: none;
        }
        
        .edit-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }
        
        /* Frequency analysis styles */
        .frequency-section {
            margin-top: 1.5rem;
        }
        
        .frequency-category {
            margin-bottom: 1rem;
        }
        
        .frequency-title {
            font-weight: bold;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .frequency-5 {
            background-color: #10B981;
            color: white;
        }
        
        .frequency-4 {
            background-color: #3B82F6;
            color: white;
        }
        
        .frequency-3 {
            background-color: #F59E0B;
            color: white;
        }
        
        .frequency-2 {
            background-color: #EF4444;
            color: white;
        }
        
        .frequency-1 {
            background-color: #6B7280;
            color: white;
        }
        
        .frequency-0 {
            background-color: #D1D5DB;
            color: #6B7280;
        }
        
        .frequency-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .frequency-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-weight: bold;
        }
        
        .screenshot-analysis {
            margin-top: 1rem;
            padding: 1rem;
            background-color: #F3F4F6;
            border-radius: 0.5rem;
        }
        
        .screenshot-numbers {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .frequency-count {
            font-size: 0.75rem;
            margin-left: 0.5rem;
            background-color: rgba(255, 255, 255, 0.3);
            padding: 0.1rem 0.3rem;
            border-radius: 0.25rem;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-bold text-blue-800 mb-2">Bingo Card Generator</h1>
            <p class="text-lg text-blue-600">Create up to 25 bingo cards using Bingo Plus results</p>
        </header>

        <main class="max-w-6xl mx-auto">
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <!-- Upload Section -->
                <div class="bg-white rounded-xl shadow-lg p-6 no-print">
                    <h2 class="text-2xl font-bold text-blue-800 mb-4">Upload Screenshots</h2>
                    <p class="text-gray-600 mb-6">Upload your Bingo Plus screenshots (1-5 screenshots recommended).</p>

                    <div class="drag-area border-2 border-dashed border-blue-300 rounded-lg p-6 text-center mb-6 bg-blue-50" id="drag-area">
                        <i class="fas fa-cloud-upload-alt text-blue-500 text-4xl mb-3"></i>
                        <p class="text-blue-700 font-medium mb-2">Drag & Drop your screenshots here</p>
                        <p class="text-blue-500 text-sm">or</p>
                        <label for="file-upload" class="mt-3 cursor-pointer inline-block bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-file-image mr-2"></i>Browse Files
                        </label>
                        <input id="file-upload" type="file" accept="image/*" class="hidden" multiple>
                    </div>

                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-3">Uploaded Screenshots</h3>
                        <div class="grid grid-cols-3 gap-3" id="uploaded-images"></div>
                    </div>

                    <!-- Sample Screenshot -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Sample Screenshot</h3>
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <p class="text-gray-600 mb-2">Here's an example of what a Bingo Plus screenshot looks like:</p>
                            <div class="bg-white p-4 rounded-lg border border-gray-300 inline-block">
                                <div class="text-center font-bold text-lg mb-2">BINGO PLUS</div>
                                <div class="grid grid-cols-5 gap-1 mb-2">
                                    <div class="bg-blue-500 text-white p-2 text-center rounded">B</div>
                                    <div class="bg-red-500 text-white p-2 text-center rounded">I</div>
                                    <div class="bg-gray-500 text-white p-2 text-center rounded">N</div>
                                    <div class="bg-green-500 text-white p-2 text-center rounded">G</div>
                                    <div class="bg-yellow-500 text-white p-2 text-center rounded">O</div>
                                </div>
                                <div class="text-center text-sm text-gray-600">Numbers: 5, 12, 23, 34, 45, 56, 67, 70</div>
                                <div class="text-center text-xs text-gray-500 mt-2">Upload screenshots like this for analysis</div>
                            </div>
                        </div>
                    </div>

                    <button class="w-full bg-indigo-600 hover:bg-indigo-700 text-white py-3 rounded-lg font-semibold flex items-center justify-center mb-6" id="analyze-btn">
                        <i class="fas fa-search mr-2"></i> Analyze Screenshots for Numbers
                    </button>
                    
                    <!-- Lucky Numbers Section - Initially hidden -->
                    <div class="mb-4 hidden" id="lucky-numbers-section">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Lucky Numbers</h3>
                        
                        <!-- Lucky Numbers Tabs -->
                        <div class="grid grid-cols-4 gap-1 mb-4 bg-gray-100 rounded-lg p-1">
                            <button class="lucky-chart-tab rounded-md text-center font-medium active" data-chart="20">
                                Lucky 20
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="25">
                                Lucky 25
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="30">
                                Lucky 30
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="35">
                                Lucky 35
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="40">
                                Lucky 40
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="44">
                                Lucky 44
                            </button>
                            <button class="lucky-chart-tab rounded-md text-center font-medium" data-chart="48">
                                Lucky 48
                            </button>
                        </div>
                        
                        <!-- Lucky Numbers Charts -->
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <!-- Lucky 20 Chart -->
                            <div id="lucky-chart-20" class="lucky-chart active">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-20" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 25 Chart -->
                            <div id="lucky-chart-25" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-25" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 30 Chart -->
                            <div id="lucky-chart-30" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-30" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 35 Chart -->
                            <div id="lucky-chart-35" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-35" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 40 Chart -->
                            <div id="lucky-chart-40" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-40" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 44 Chart -->
                            <div id="lucky-chart-44" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-44" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                            
                            <!-- Lucky 48 Chart -->
                            <div id="lucky-chart-48" class="lucky-chart">
                                <div class="grid grid-cols-5 gap-2 mb-4">
                                    <div class="text-center font-bold text-blue-800">B (1-15)</div>
                                    <div class="text-center font-bold text-red-600">I (16-30)</div>
                                    <div class="text-center font-bold text-gray-600">N (31-45)</div>
                                    <div class="text-center font-bold text-green-600">G (46-60)</div>
                                    <div class="text-center font-bold text-yellow-600">O (61-75)</div>
                                </div>
                                <div id="lucky-numbers-48" class="flex flex-wrap gap-2">
                                    <span class="text-gray-500">No lucky numbers detected yet</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Frequency Analysis Section - Initially hidden -->
                    <div class="frequency-section hidden" id="frequency-section">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">Number Frequency Analysis</h3>
                        <p class="text-gray-600 mb-4">All numbers from 1-75 categorized by appearance frequency across screenshots:</p>
                        
                        <!-- Screenshot Analysis -->
                        <div class="screenshot-analysis">
                            <h4 class="font-semibold text-blue-700 mb-2">Detected Numbers by Screenshot</h4>
                            <div id="screenshot-analysis-container"></div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-5">Appeared 5 times</div>
                            <div id="frequency-5" class="frequency-numbers">
                                <span class="text-gray-500">No numbers in this category</span>
                            </div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-4">Appeared 4 times</div>
                            <div id="frequency-4" class="frequency-numbers">
                                <span class="text-gray-500">No numbers in this category</span>
                            </div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-3">Appeared 3 times</div>
                            <div id="frequency-3" class="frequency-numbers">
                                <span class="text-gray-500">No numbers in this category</span>
                            </div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-2">Appeared 2 times</div>
                            <div id="frequency-2" class="frequency-numbers">
                                <span class="text-gray-500">No numbers in this category</span>
                            </div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-1">Appeared 1 time</div>
                            <div id="frequency-1" class="frequency-numbers">
                                <span class="text-gray-500">No numbers in this category</span>
                            </div>
                        </div>
                        
                        <div class="frequency-category">
                            <div class="frequency-title frequency-0">Not Appeared (0 times)</div>
                            <div id="frequency-0" class="frequency-numbers">
                                <span class="text-gray-500">All numbers appeared at least once</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Configuration -->
                <div class="bg-white rounded-xl shadow-lg p-6 no-print">
                    <h2 class="text-2xl font-bold text-blue-800 mb-4">Card Configuration</h2>

                    <div class="mb-6">
                        <label class="block text-blue-800 font-medium mb-2">Number of Cards (Max 25)</label>
                        <div class="flex items-center">
                            <button class="bg-blue-200 text-blue-800 w-10 h-10 rounded-l-lg" id="decrease-cards"><i class="fas fa-minus"></i></button>
                            <input type="number" min="1" max="25" value="3" class="w-16 h-10 text-center border-t border-b border-blue-200" id="card-count">
                            <button class="bg-blue-200 text-blue-800 w-10 h-10 rounded-r-lg" id="increase-cards"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>

                    <div class="mb-6">
                        <label class="flex items-center">
                            <input type="checkbox" class="rounded text-blue-600 mr-2" id="include-free-space" checked>
                            <span class="text-blue-800">Include free space in center</span>
                        </label>
                    </div>

                    <!-- Winning Pattern Selector -->
                    <div class="mb-6">
                        <label class="block text-blue-800 font-medium mb-2">Winning Pattern</label>
                        <div class="grid grid-cols-2 gap-3" id="pattern-selection">
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="none">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                </div>
                                <span class="text-sm font-medium">None</span>
                            </div>
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="four-corners">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                </div>
                                <span class="text-sm font-medium">Four Corners</span>
                            </div>
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="x">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                </div>
                                <span class="text-sm font-medium">X Pattern</span>
                            </div>
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="line">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                </div>
                                <span class="text-sm font-medium">T Pattern</span>
                            </div>
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="hallow">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                </div>
                                <span class="text-sm font-medium">Hallow</span>
                            </div>
                            <div class="pattern-selection border-2 border-gray-200 rounded-lg p-3 text-center" data-pattern="blackout">
                                <div class="pattern-preview mb-2">
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                    <div class="pattern-cell active"></div>
                                </div>
                                <span class="text-sm font-medium">Blackout</span>
                            </div>
                        </div>
                    </div>

                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold flex items-center justify-center" id="generate-btn">
                        <i class="fas fa-magic mr-2"></i> Generate Bingo Cards
                    </button>
                </div>
            </div>

            <!-- Generated Cards Section - Initially hidden -->
            <div class="cards-section bg-white rounded-xl shadow-lg p-6" id="cards-section">
                <div class="flex justify-between items-center mb-6 no-print">
                    <h2 class="text-2xl font-bold text-blue-800">Generated Bingo Cards</h2>
                    <div class="flex space-x-2">
                        <button class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg flex items-center" id="download-btn">
                            <i class="fas fa-download mr-2"></i> Download All
                        </button>
                        <button class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg flex items-center" id="print-btn">
                            <i class="fas fa-print mr-2"></i> Print Cards
                        </button>
                        <button class="bg-purple-600 hover:bg-purple-700 text-white py-2 px-4 rounded-lg flex items-center" id="edit-btn">
                            <i class="fas fa-edit mr-2"></i> Edit Cards
                        </button>
                    </div>
                </div>

                <!-- Placeholder when no cards are generated -->
                <div class="cards-placeholder" id="cards-placeholder">
                    <i class="fas fa-dice"></i>
                    <h3 class="text-xl font-semibold text-gray-600 mb-2">No Bingo Cards Generated Yet</h3>
                    <p class="text-gray-500">Configure your settings and click "Generate Bingo Cards" to create your cards.</p>
                </div>

                <!-- Container for generated cards -->
                <div class="grid md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="cards-container"></div>
            </div>
        </main>

        <footer class="mt-12 text-center text-blue-600 no-print">
            <p>© 2023 Bingo Card Generator | Created for Bingo Plus players</p>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const CARDS_LIMIT = 25;
        const cardCountInput = document.getElementById('card-count');
        const decreaseBtn = document.getElementById('decrease-cards');
        const increaseBtn = document.getElementById('increase-cards');
        const generateBtn = document.getElementById('generate-btn');
        const printBtn = document.getElementById('print-btn');
        const downloadBtn = document.getElementById('download-btn');
        const editBtn = document.getElementById('edit-btn');
        const cardsContainer = document.getElementById('cards-container');
        const cardsSection = document.getElementById('cards-section');
        const cardsPlaceholder = document.getElementById('cards-placeholder');
        const dragArea = document.getElementById('drag-area');
        const fileUpload = document.getElementById('file-upload');
        const uploadedImagesContainer = document.getElementById('uploaded-images');
        const analyzeBtn = document.getElementById('analyze-btn');
        const patternSelection = document.getElementById('pattern-selection');
        const luckyNumbersSection = document.getElementById('lucky-numbers-section');
        const frequencySection = document.getElementById('frequency-section');
        const luckyChartTabs = document.querySelectorAll('.lucky-chart-tab');

        let calledNumbers = [];
        let uploadedFiles = [];
        let selectedPattern = 'none';
        let cardsGenerated = false;
        let analyzedNumbers = [];
        let numberFrequency = {};
        let isEditMode = false;
        let screenshotNumbers = {};

        const COL_KEYS = ['B', 'I', 'N', 'G', 'O'];
        const COL_RANGES = {
            B: [1, 15],
            I: [16, 30],
            N: [31, 45],
            G: [46, 60],
            O: [61, 75]
        };

        // Card count controls
        decreaseBtn.addEventListener('click', () => {
            if (cardCountInput.value > 1) cardCountInput.value--;
        });
        increaseBtn.addEventListener('click', () => {
            if (cardCountInput.value < CARDS_LIMIT) cardCountInput.value++;
        });

        generateBtn.addEventListener('click', generateCards);
        printBtn.addEventListener('click', () => window.print());
        downloadBtn.addEventListener('click', downloadCards);
        editBtn.addEventListener('click', toggleEditMode);
        analyzeBtn.addEventListener('click', analyzeScreenshots);

        // Pattern selection
        patternSelection.querySelectorAll('.pattern-selection').forEach(el => {
            el.addEventListener('click', () => {
                patternSelection.querySelectorAll('.pattern-selection').forEach(e => {
                    e.classList.remove('selected');
                });
                el.classList.add('selected');
                selectedPattern = el.dataset.pattern;
            });
        });

        // Lucky chart tabs
        luckyChartTabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                luckyChartTabs.forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Hide all charts
                document.querySelectorAll('.lucky-chart').forEach(chart => {
                    chart.classList.remove('active');
                });
                
                // Show selected chart
                const chartId = `lucky-chart-${tab.dataset.chart}`;
                document.getElementById(chartId).classList.add('active');
            });
        });

        // Set default pattern
        patternSelection.querySelector('.pattern-selection[data-pattern="none"]').classList.add('selected');

        // Drag & drop upload
        dragArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dragArea.classList.add('active');
        });
        dragArea.addEventListener('dragleave', () => dragArea.classList.remove('active'));
        dragArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dragArea.classList.remove('active');
            handleFiles(e.dataTransfer.files);
        });
        fileUpload.addEventListener('change', (e) => handleFiles(e.target.files));

        function handleFiles(files) {
            for (let i = 0; i < files.length; i++) {
                if (files[i].type.startsWith('image/')) {
                    uploadedFiles.push(files[i]);
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imgDiv = document.createElement('div');
                        imgDiv.className = 'relative';
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'uploaded-image border border-gray-200';
                        const removeBtn = document.createElement('button');
                        removeBtn.className = 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs';
                        removeBtn.innerHTML = '&times;';
                        removeBtn.onclick = () => {
                            imgDiv.remove();
                            uploadedFiles = uploadedFiles.filter(f => f !== files[i]);
                        };
                        imgDiv.appendChild(img);
                        imgDiv.appendChild(removeBtn);
                        uploadedImagesContainer.appendChild(imgDiv);
                    };
                    reader.readAsDataURL(files[i]);
                }
            }
        }

        // Enhanced OCR analysis with pattern detection
        function analyzeScreenshots() {
            if (uploadedFiles.length === 0) {
                alert('Please upload at least one screenshot first!');
                return;
            }
            analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Analyzing...';
            analyzeBtn.classList.add('analysis-animation');

            setTimeout(() => {
                // Enhanced analysis: Extract numbers from multiple screenshots
                analyzedNumbers = [];
                numberFrequency = {};
                screenshotNumbers = {};
                
                // Initialize frequency for all numbers 1-75
                for (let i = 1; i <= 75; i++) {
                    numberFrequency[i] = 0;
                }
                
                // Simulate extracting numbers from each screenshot
                for (let i = 0; i < uploadedFiles.length; i++) {
                    // Generate different numbers for each screenshot to simulate real analysis
                    const numbers = generateScreenshotNumbers(i);
                    screenshotNumbers[`Screenshot ${i+1}`] = numbers;
                    analyzedNumbers = analyzedNumbers.concat(numbers);
                    
                    // Count frequency of each number
                    numbers.forEach(num => {
                        numberFrequency[num]++;
                    });
                }
                
                // Remove duplicates and sort
                analyzedNumbers = [...new Set(analyzedNumbers)].sort((a, b) => a - b);
                
                // Generate different sets of numbers for each chart
                const lucky20Numbers = generateLuckyNumbers(20, analyzedNumbers, numberFrequency);
                const lucky25Numbers = generateLuckyNumbers(25, analyzedNumbers, numberFrequency);
                const lucky30Numbers = generateLuckyNumbers(30, analyzedNumbers, numberFrequency);
                const lucky35Numbers = generateLuckyNumbers(35, analyzedNumbers, numberFrequency);
                const lucky40Numbers = generateLuckyNumbers(40, analyzedNumbers, numberFrequency);
                const lucky44Numbers = generateLuckyNumbers(44, analyzedNumbers, numberFrequency);
                const lucky48Numbers = generateLuckyNumbers(48, analyzedNumbers, numberFrequency);
                
                // Use the 20-number set for bingo cards
                calledNumbers = lucky20Numbers;
                
                // Update all lucky number charts
                updateLuckyNumbersChart('20', lucky20Numbers);
                updateLuckyNumbersChart('25', lucky25Numbers);
                updateLuckyNumbersChart('30', lucky30Numbers);
                updateLuckyNumbersChart('35', lucky35Numbers);
                updateLuckyNumbersChart('40', lucky40Numbers);
                updateLuckyNumbersChart('44', lucky44Numbers);
                updateLuckyNumbersChart('48', lucky48Numbers);
                
                // Show frequency analysis
                updateFrequencyAnalysis();
                
                // Show screenshot analysis
                updateScreenshotAnalysis();
                
                // Show lucky numbers section after analysis
                luckyNumbersSection.classList.remove('hidden');
                frequencySection.classList.remove('hidden');
                
                analyzeBtn.innerHTML = '<i class="fas fa-search mr-2"></i> Analyze Screenshots for Numbers';
                analyzeBtn.classList.remove('analysis-animation');
                
                // Show analysis summary
                showAnalysisSummary();
            }, 2000);
        }
        
        function generateScreenshotNumbers(screenshotIndex) {
            // Create realistic numbers for each screenshot with controlled frequency
            // This ensures we get numbers that appear 1, 2, 3, 4, and 5 times
            
            let numbers = [];
            const numbersPerScreenshot = 12;
            
            // Create a controlled distribution for testing
            // Numbers that will appear in specific numbers of screenshots
            const frequencyDistribution = {
                5: [5, 12, 23, 34], // These will appear in all 5 screenshots
                4: [8, 19, 27, 41], // These will appear in 4 screenshots
                3: [7, 14, 25, 36], // These will appear in 3 screenshots
                2: [2, 11, 22, 33], // These will appear in 2 screenshots
                1: [9, 16, 28, 39]  // These will appear in 1 screenshot
            };
            
            // Add numbers based on screenshot index to create the desired frequency
            if (screenshotIndex < 5) {
                // Add numbers that appear 5 times (all screenshots)
                numbers = numbers.concat(frequencyDistribution[5]);
            }
            
            if (screenshotIndex < 4) {
                // Add numbers that appear 4 times (first 4 screenshots)
                numbers = numbers.concat(frequencyDistribution[4]);
            }
            
            if (screenshotIndex < 3) {
                // Add numbers that appear 3 times (first 3 screenshots)
                numbers = numbers.concat(frequencyDistribution[3]);
            }
            
            if (screenshotIndex < 2) {
                // Add numbers that appear 2 times (first 2 screenshots)
                numbers = numbers.concat(frequencyDistribution[2]);
            }
            
            if (screenshotIndex < 1) {
                // Add numbers that appear 1 time (first screenshot only)
                numbers = numbers.concat(frequencyDistribution[1]);
            }
            
            // Fill remaining slots with random numbers
            while (numbers.length < numbersPerScreenshot) {
                const num = Math.floor(Math.random() * 75) + 1;
                if (!numbers.includes(num)) {
                    numbers.push(num);
                }
            }
            
            return numbers.sort((a, b) => a - b);
        }
        
        function updateScreenshotAnalysis() {
            const container = document.getElementById('screenshot-analysis-container');
            container.innerHTML = '';
            
            Object.keys(screenshotNumbers).forEach(screenshotName => {
                const screenshotDiv = document.createElement('div');
                screenshotDiv.className = 'mb-3';
                
                const title = document.createElement('div');
                title.className = 'font-medium text-gray-700 mb-1';
                title.textContent = `${screenshotName}:`;
                
                const numbersDiv = document.createElement('div');
                numbersDiv.className = 'screenshot-numbers';
                
                screenshotNumbers[screenshotName].forEach(num => {
                    const badge = document.createElement('span');
                    badge.className = `frequency-badge ${getLuckyBadgeClass(num)}`;
                    badge.textContent = num;
                    
                    // Add frequency count to each number badge
                    const frequencyCount = document.createElement('span');
                    frequencyCount.className = 'frequency-count';
                    frequencyCount.textContent = `x${numberFrequency[num]}`;
                    badge.appendChild(frequencyCount);
                    
                    numbersDiv.appendChild(badge);
                });
                
                screenshotDiv.appendChild(title);
                screenshotDiv.appendChild(numbersDiv);
                container.appendChild(screenshotDiv);
            });
        }
        
        function updateFrequencyAnalysis() {
            // Group numbers by frequency
            const frequencyGroups = {
                5: [],
                4: [],
                3: [],
                2: [],
                1: [],
                0: []
            };
            
            // Populate frequency groups for all numbers 1-75
            for (let num = 1; num <= 75; num++) {
                const frequency = numberFrequency[num];
                if (frequency >= 5) {
                    frequencyGroups[5].push(num);
                } else if (frequency === 4) {
                    frequencyGroups[4].push(num);
                } else if (frequency === 3) {
                    frequencyGroups[3].push(num);
                } else if (frequency === 2) {
                    frequencyGroups[2].push(num);
                } else if (frequency === 1) {
                    frequencyGroups[1].push(num);
                } else if (frequency === 0) {
                    frequencyGroups[0].push(num);
                }
            }
            
            // Sort each group
            Object.keys(frequencyGroups).forEach(freq => {
                frequencyGroups[freq].sort((a, b) => a - b);
            });
            
            // Update the UI for each frequency category
            for (let freq = 0; freq <= 5; freq++) {
                const container = document.getElementById(`frequency-${freq}`);
                container.innerHTML = '';
                
                if (frequencyGroups[freq].length === 0) {
                    if (freq === 0) {
                        container.innerHTML = '<span class="text-gray-500">All numbers appeared at least once</span>';
                    } else {
                        container.innerHTML = '<span class="text-gray-500">No numbers in this category</span>';
                    }
                } else {
                    frequencyGroups[freq].forEach(num => {
                        const badge = document.createElement('span');
                        badge.className = `frequency-badge ${getLuckyBadgeClass(num)}`;
                        badge.textContent = num;
                        container.appendChild(badge);
                    });
                }
            }
        }
        
        function showAnalysisSummary() {
            // Create a summary of the analysis
            const summaryDiv = document.createElement('div');
            summaryDiv.className = 'bg-green-50 p-4 rounded-lg mt-4';
            
            // Calculate coverage
            const appearedNumbers = Object.keys(numberFrequency).filter(num => numberFrequency[num] > 0).length;
            const coveragePercentage = ((appearedNumbers / 75) * 100).toFixed(1);
            
            // Count numbers by frequency
            const frequencyCounts = {
                5: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 5).length,
                4: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 4).length,
                3: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 3).length,
                2: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 2).length,
                1: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 1).length,
                0: Object.keys(numberFrequency).filter(num => numberFrequency[num] === 0).length
            };
            
            let summaryHTML = `
                <h4 class="font-bold text-green-800 mb-2">Analysis Summary</h4>
                <p class="text-green-700">Analyzed ${uploadedFiles.length} screenshots and detected ${appearedNumbers} out of 75 numbers (${coveragePercentage}% coverage).</p>
                <p class="text-green-700 mt-2">Frequency Distribution:</p>
                <ul class="text-green-700 list-disc list-inside">
                    <li>Appeared 5 times: ${frequencyCounts[5]} numbers</li>
                    <li>Appeared 4 times: ${frequencyCounts[4]} numbers</li>
                    <li>Appeared 3 times: ${frequencyCounts[3]} numbers</li>
                    <li>Appeared 2 times: ${frequencyCounts[2]} numbers</li>
                    <li>Appeared 1 time: ${frequencyCounts[1]} numbers</li>
                    <li>Not appeared: ${frequencyCounts[0]} numbers</li>
                </ul>
                <p class="text-green-700 mt-2">Most frequent numbers: ${getMostFrequentNumbers(5).join(', ')}</p>
            `;
            
            summaryDiv.innerHTML = summaryHTML;
            
            // Insert after the lucky numbers section
            luckyNumbersSection.parentNode.insertBefore(summaryDiv, luckyNumbersSection.nextSibling);
        }
        
        function getMostFrequentNumbers(count) {
            // Sort numbers by frequency
            const sortedNumbers = Object.keys(numberFrequency)
                .map(num => ({num: parseInt(num), freq: numberFrequency[num]}))
                .sort((a, b) => b.freq - a.freq)
                .slice(0, count)
                .map(item => item.num);
                
            return sortedNumbers;
        }

        function generateLuckyNumbers(count, baseNumbers, frequency) {
            let numbers = [];
            
            // First, add the most frequent numbers from the analysis
            const frequentNumbers = getMostFrequentNumbers(Math.min(count, baseNumbers.length));
            numbers = [...frequentNumbers];
            
            // Then fill with random numbers if needed
            while (numbers.length < count) {
                let num = Math.floor(Math.random() * 75) + 1;
                if (!numbers.includes(num)) numbers.push(num);
            }
            
            return numbers.sort((a, b) => a - b);
        }

        function getLuckyBadgeClass(num) {
            if (num >= 1 && num <= 15) return 'lucky-badge-b';
            else if (num >= 16 && num <= 30) return 'lucky-badge-i';
            else if (num >= 31 && num <= 45) return 'lucky-badge-n';
            else if (num >= 46 && num <= 60) return 'lucky-badge-g';
            else if (num >= 61 && num <= 75) return 'lucky-badge-o';
            return '';
        }

        function updateLuckyNumbersChart(chartSize, numbers) {
            const container = document.getElementById(`lucky-numbers-${chartSize}`);
            container.innerHTML = '';
            
            if (numbers.length === 0) {
                container.innerHTML = '<span class="text-gray-500">No lucky numbers detected yet</span>';
                return;
            }
            
            numbers.forEach(num => {
                const badge = document.createElement('span');
                badge.className = `px-3 py-1 rounded-full number-badge ${getLuckyBadgeClass(num)}`;
                badge.textContent = num;
                container.appendChild(badge);
            });
        }

        function getNumberClass(num) {
            if (num >= 1 && num <= 15) return 'number-b';
            else if (num >= 16 && num <= 30) return 'number-i';
            else if (num >= 31 && num <= 45) return 'number-n';
            else if (num >= 46 && num <= 60) return 'number-g';
            else if (num >= 61 && num <= 75) return 'number-o';
            return '';
        }

        function groupNumbersByColumn() {
            let layout = { B: [], I: [], N: [], G: [], O: [] };
            
            // First, add any called numbers to their respective columns
            calledNumbers.forEach(num => {
                if (num >= 1 && num <= 15) layout.B.push(num);
                else if (num >= 16 && num <= 30) layout.I.push(num);
                else if (num >= 31 && num <= 45) layout.N.push(num);
                else if (num >= 46 && num <= 60) layout.G.push(num);
                else if (num >= 61 && num <= 75) layout.O.push(num);
            });
            
            // Then fill each column with random numbers if needed
            for (let key of COL_KEYS) {
                const [min, max] = COL_RANGES[key];
                while (layout[key].length < 5) {
                    let n = Math.floor(Math.random() * (max - min + 1)) + min;
                    if (!layout[key].includes(n)) layout[key].push(n);
                }
                layout[key] = shuffleArray(layout[key]).slice(0, 5);
            }
            return layout;
        }

        function shuffleArray(arr) {
            let copy = [...arr];
            for (let i = copy.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [copy[i], copy[j]] = [copy[j], copy[i]];
            }
            return copy;
        }

        function generateCards() {
            const cardCount = parseInt(cardCountInput.value);
            const includeFreeSpace = document.getElementById('include-free-space').checked;
            cardsContainer.innerHTML = '';

            // If no called numbers, generate some random ones for demo
            if (!calledNumbers || calledNumbers.length === 0) {
                calledNumbers = generateLuckyNumbers(20, analyzedNumbers, numberFrequency);
                updateLuckyNumbersChart('20', calledNumbers);
            }

            for (let i = 1; i <= cardCount; i++) {
                const columnPools = groupNumbersByColumn();
                const cardDiv = document.createElement('div');
                cardDiv.className = 'border-2 border-blue-300 rounded-xl p-4 bg-blue-50 card-container';
                cardDiv.dataset.cardId = i;
                
                const cardTitle = document.createElement('h3');
                cardTitle.className = 'text-center font-bold text-blue-800 mb-2';
                cardTitle.textContent = `Card #${i}`;
                
                const cardGrid = document.createElement('div');
                cardGrid.className = 'grid grid-cols-5 gap-1 mx-auto max-w-xs bingo-card';

                // Column headers
                COL_KEYS.forEach(l => {
                    const h = document.createElement('div');
                    h.className = 'bg-blue-100 text-blue-800 font-bold rounded-lg p-2 text-center h-12 flex items-center justify-center';
                    h.textContent = l;
                    cardGrid.appendChild(h);
                });

                // Cells
                for (let row = 0; row < 5; row++) {
                    for (let col = 0; col < 5; col++) {
                        const colKey = COL_KEYS[col];
                        let num = columnPools[colKey][row];
                        const cell = document.createElement('div');
                        cell.className = 'bg-white rounded-lg p-2 text-center h-12 flex items-center justify-center bingo-cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        cell.dataset.colKey = colKey;

                        if (includeFreeSpace && row === 2 && col === 2) {
                            cell.innerHTML = '<i class="fas fa-star text-blue-600"></i>';
                            cell.classList.add('bg-blue-200');
                        } else {
                            cell.textContent = num;
                            // Add color coding based on number range
                            cell.classList.add(getNumberClass(num));
                            
                            if (calledNumbers.includes(num)) {
                                cell.classList.add('called');
                            }
                        }

                        // Pattern logic
                        if (selectedPattern === "x") {
                            if (row === col || row + col === 4) cell.classList.add('pattern-x');
                        } else if (selectedPattern === "four-corners") {
                            if ((row === 0 && col === 0) || (row === 0 && col === 4) ||
                                (row === 4 && col === 0) || (row === 4 && col === 4)) {
                                cell.classList.add('pattern-four-corners');
                            }
                        } else if (selectedPattern === "blackout") {
                            cell.classList.add('pattern-blackout');
                        } else if (selectedPattern === "line") { 
                            if (row === 0 || col === 2) cell.classList.add('pattern-line');
                        } else if (selectedPattern === "hallow") {
                            if (row === 0 || row === 4 || col === 0 || col === 4) {
                                cell.classList.add('pattern-hallow');
                            }
                        }

                        // Add click functionality to mark numbers
                        cell.addEventListener('click', function() {
                            if (isEditMode) {
                                // In edit mode, allow editing the number
                                editCellNumber(this);
                            } else {
                                // Toggle marked state
                                this.classList.toggle('marked');
                                
                                // If marked, remove the original color classes
                                if (this.classList.contains('marked')) {
                                    this.classList.remove('number-b', 'number-i', 'number-n', 'number-g', 'number-o', 'called');
                                } else {
                                    // If unmarked, restore the original color class
                                    this.classList.add(getNumberClass(num));
                                    if (calledNumbers.includes(num)) {
                                        this.classList.add('called');
                                    }
                                }
                            }
                        });

                        cardGrid.appendChild(cell);
                    }
                }

                cardDiv.appendChild(cardTitle);
                cardDiv.appendChild(cardGrid);
                
                // Add probability indicator
                const probabilityIndicator = document.createElement('div');
                probabilityIndicator.className = 'probability-indicator high-probability';
                probabilityIndicator.textContent = 'High Winning Probability';
                cardDiv.appendChild(probabilityIndicator);
                
                // Add winning pattern indicator
                if (selectedPattern !== 'none') {
                    const patternIndicator = document.createElement('div');
                    patternIndicator.className = 'winning-pattern';
                    patternIndicator.textContent = `Winning Pattern: ${selectedPattern}`;
                    cardDiv.appendChild(patternIndicator);
                }
                
                cardsContainer.appendChild(cardDiv);
            }
            
            // Show the cards section and hide the placeholder
            cardsSection.style.display = 'block';
            cardsPlaceholder.style.display = 'none';
            cardsGenerated = true;
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            
            if (isEditMode) {
                // Enter edit mode
                editBtn.innerHTML = '<i class="fas fa-save mr-2"></i> Save Changes';
                editBtn.classList.remove('bg-purple-600');
                editBtn.classList.add('bg-green-600');
                
                // Add edit mode styling to cards
                document.querySelectorAll('.card-container').forEach(card => {
                    card.classList.add('edit-mode');
                });
                
                // Show edit instructions
                showEditInstructions();
            } else {
                // Exit edit mode
                editBtn.innerHTML = '<i class="fas fa-edit mr-2"></i> Edit Cards';
                editBtn.classList.remove('bg-green-600');
                editBtn.classList.add('bg-purple-600');
                
                // Remove edit mode styling
                document.querySelectorAll('.card-container').forEach(card => {
                    card.classList.remove('edit-mode');
                });
                
                // Remove any active editing
                document.querySelectorAll('.bingo-cell.editing').forEach(cell => {
                    cell.classList.remove('editing');
                    const input = cell.querySelector('input');
                    if (input) {
                        cell.textContent = input.value || cell.textContent;
                        // Update the color class based on the new number
                        const newNum = parseInt(cell.textContent);
                        if (!isNaN(newNum)) {
                            cell.classList.remove('number-b', 'number-i', 'number-n', 'number-g', 'number-o');
                            cell.classList.add(getNumberClass(newNum));
                        }
                    }
                });
                
                // Hide edit instructions
                hideEditInstructions();
            }
        }

        function showEditInstructions() {
            const instructions = document.createElement('div');
            instructions.id = 'edit-instructions';
            instructions.className = 'bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 mb-4';
            instructions.innerHTML = `
                <p class="font-bold">Edit Mode Active</p>
                <p>Click on any number to edit it. Press Enter to save or click outside to cancel.</p>
            `;
            
            cardsSection.insertBefore(instructions, cardsContainer);
        }

        function hideEditInstructions() {
            const instructions = document.getElementById('edit-instructions');
            if (instructions) {
                instructions.remove();
            }
        }

        function editCellNumber(cell) {
            // Remove editing from any other cells
            document.querySelectorAll('.bingo-cell.editing').forEach(c => {
                c.classList.remove('editing');
                const input = c.querySelector('input');
                if (input) {
                    c.textContent = input.value || c.textContent;
                    // Update the color class based on the new number
                    const newNum = parseInt(c.textContent);
                    if (!isNaN(newNum)) {
                        c.classList.remove('number-b', 'number-i', 'number-n', 'number-g', 'number-o');
                        c.classList.add(getNumberClass(newNum));
                    }
                }
            });
            
            // Skip free space cells
            if (cell.innerHTML.includes('fa-star')) {
                return;
            }
            
            // Add editing class
            cell.classList.add('editing');
            
            // Get current value
            const currentValue = cell.textContent;
            
            // Create input field
            const input = document.createElement('input');
            input.type = 'number';
            input.className = 'edit-input';
            input.value = currentValue;
            input.min = 1;
            input.max = 75;
            
            // Clear cell and add input
            cell.textContent = '';
            cell.appendChild(input);
            input.focus();
            input.select();
            
            // Handle input events
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    // Save on Enter
                    cell.textContent = input.value;
                    cell.classList.remove('editing');
                    
                    // Update the color class based on the new number
                    const newNum = parseInt(input.value);
                    if (!isNaN(newNum)) {
                        cell.classList.remove('number-b', 'number-i', 'number-n', 'number-g', 'number-o');
                        cell.classList.add(getNumberClass(newNum));
                    }
                } else if (e.key === 'Escape') {
                    // Cancel on Escape
                    cell.textContent = currentValue;
                    cell.classList.remove('editing');
                }
            });
            
            input.addEventListener('blur', function() {
                // Save on blur
                cell.textContent = input.value || currentValue;
                cell.classList.remove('editing');
                
                // Update the color class based on the new number
                const newNum = parseInt(cell.textContent);
                if (!isNaN(newNum)) {
                    cell.classList.remove('number-b', 'number-i', 'number-n', 'number-g', 'number-o');
                    cell.classList.add(getNumberClass(newNum));
                }
            });
        }

        function downloadCards() {
            if (!cardsGenerated) {
                alert('Please generate cards first!');
                return;
            }
            
            // Create a canvas to render all cards
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const cards = document.querySelectorAll('.bingo-card');
            
            if (cards.length === 0) {
                alert('Please generate cards first!');
                return;
            }
            
            // For a real implementation, you would need to render each card to the canvas
            // and then convert to PDF or image. For now, we'll just show an alert.
            alert('Download functionality would save all cards as a PDF in a real implementation.');
            
            // In a real implementation, you would use a library like jsPDF
            // to create a PDF document with all the cards
        }
        
        // Initially hide the cards section
        cardsSection.style.display = 'none';
    });
    </script>
</body>
</html>
